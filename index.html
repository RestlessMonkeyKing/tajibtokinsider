<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>TajibTok (RMK CONNEX.)</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
    body {
        margin:0;
        font-family: Arial, sans-serif;
        background:#09090f;
        color:white;
        display:flex;
        height:100vh;
        overflow:hidden;
    }

    /* MATERIAL GLASS THEME */
    .material-glass {
        background: rgba(255, 255, 255, 0.25);
        backdrop-filter: blur(6px);
        border: 2px solid rgba(255, 255, 255, 0.45);
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 6px 24px rgba(31, 38, 135, 0.65);
    }

    /* LAYOUT */
    #sidebar {
        width: 260px;
        padding:20px;
        display:flex;
        flex-direction:column;
        gap:20px;
    }

    #main {
        flex:1;
        display:flex;
        justify-content:center;
        align-items:center;
    }

    #rightbar {
        width: 160px;
        padding:20px;
        display:flex;
        flex-direction:column;
        gap:20px;
        align-items:center;
    }

    /* UPLOAD BOX */
    #uploadBox {
        display:flex;
        flex-direction:column;
        gap:10px;
    }

    #progressBox {
        display:none;
        width:100%;
    }

    #progressBar {
        width:0%;
        height:12px;
        background:#00ffb7;
        border-radius:6px;
        transition:0.2s;
    }

    /* VIDEO PLAYER */
    video {
        width:340px;
        height:600px;
        border-radius:20px;
        object-fit:cover;
        background:black;
    }

    /* RIGHT ACTION BUTTONS */
    .circleBtn {
        width:60px;
        height:60px;
        border-radius:50%;
        background:white;
        color:black;
        display:flex;
        align-items:center;
        justify-content:center;
        font-size:20px;
        cursor:pointer;
        transition:0.2s;
    }

    .circleBtn:hover { transform: scale(1.1); }

</style>
</head>
<body>

<!-- LEFT SIDEBAR -->
<div id="sidebar" class="material-glass">
    <h2>TajibTok</h2>
    <div><b>Account:</b> Rohind</div>

    <div id="uploadBox" class="material-glass">
        <input type="file" id="videoInput" accept="video/*">

        <button id="uploadBtn">Upload Tajib</button>

        <div id="progressBox">
            <div id="progressBar"></div>
            <small id="progressText"></small>
        </div>
    </div>

    <input class="material-glass" id="searchBox" placeholder="Search tajibs...">
</div>

<!-- MIDDLE PLAYER -->
<div id="main">
    <video id="player" controls></video>
</div>

<!-- RIGHT SIDEBAR -->
<div id="rightbar" class="material-glass">
    <div class="circleBtn">‚ù§Ô∏è</div>
    <div class="circleBtn">üí¨</div>
    <div class="circleBtn">‚ÜóÔ∏è</div>
</div>

<!-- SUPABASE SDK -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
/* ===============================
   üî• SUPABASE SETUP
================================== */
const SUPABASE_URL = "YOUR_URL_HERE";
const SUPABASE_KEY = "YOUR_ANON_KEY_HERE";

const supa = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

/* ===============================
   üî• ELEMENTS
================================== */
const videoInput = document.getElementById("videoInput");
const uploadBtn = document.getElementById("uploadBtn");
const player = document.getElementById("player");
const progressBox = document.getElementById("progressBox");
const progressBar = document.getElementById("progressBar");
const progressText = document.getElementById("progressText");

/* ===============================
   üî• UPLOAD FUNCTION
================================== */
uploadBtn.onclick = async () => {
    const file = videoInput.files[0];
    if (!file) {
        alert("Choose a video first!");
        return;
    }

    const fileName = `tajibs/${Date.now()}-${file.name}`;

    progressBox.style.display = "block";

    // Upload with progress
    const { data, error } = await supa.storage
        .from("tajibtok")   // bucket name MUST EXIST
        .upload(fileName, file, {
            upsert: true,
            onUploadProgress: (evt) => {
                const percent = Math.round((evt.loaded / evt.total) * 100);
                progressBar.style.width = percent + "%";
                progressText.innerText = percent + "%";
            }
        });

    if (error) {
        alert("Upload failed: " + error.message);
        return;
    }

    // Get public URL
    const { data: urlData } = supa
        .storage
        .from("tajibtok")
        .getPublicUrl(fileName);

    const videoURL = urlData.publicUrl;

    // Save metadata in Supabase table "tajibs"
    await supa.from("tajibs").insert({
        url: videoURL,
        userid: "rohind",
        created_at: new Date()
    });

    player.src = videoURL;

    progressText.innerText = "Done!";
};
</script>
</body>
</html>
