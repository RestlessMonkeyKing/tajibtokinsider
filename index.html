<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tajib Tok - Short Video Platform</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Framer Motion -->
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        .material-glass {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(6px);
            border: 2px solid rgba(255, 255, 255, 0.45);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 6px 24px rgba(31, 38, 135, 0.65);
        }
        
        .ripple {
            position: relative;
            overflow: hidden;
        }
        
        .ripple::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            transform: translate(-50%, -50%);
            transition: width 0.3s, height 0.3s;
        }
        
        .ripple:active::after {
            width: 300px;
            height: 300px;
        }
        
        .video-container {
            aspect-ratio: 9/16;
        }
        
        .snap-y {
            scroll-snap-type: y mandatory;
        }
        
        .snap-start {
            scroll-snap-align: start;
        }
        
        /* Hide scrollbar but keep functionality */
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-purple-600 to-blue-600">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const { motion, AnimatePresence } = window.framerMotion;

        // Supabase Configuration - USING YOUR PROVIDED CREDENTIALS
        const supabaseUrl = "https://xqecfotbhbccrlamioft.supabase.co";
        const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhxZWNmb3RiaGJjY3JsYW1pb2Z0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQyMzAzNDksImV4cCI6MjA3OTgwNjM0OX0.aoSZSHK91Ota15IcExrfXZqN0FOQ8cXGWgujy9ECZOg";
        
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

        // Left Sidebar Component
        function SidebarLeft({ onUploadClick, onSearchClick }) {
            return React.createElement(motion.div, {
                initial: { x: -100, opacity: 0 },
                animate: { x: 0, opacity: 1 },
                transition: { duration: 0.5 },
                className: "w-64 h-full p-6"
            },
                React.createElement("div", { className: "material-glass h-full flex flex-col" },
                    // User Info
                    React.createElement(motion.div, {
                        initial: { y: -20, opacity: 0 },
                        animate: { y: 0, opacity: 1 },
                        transition: { delay: 0.2 },
                        className: "flex items-center space-x-3 mb-8"
                    },
                        React.createElement("div", { className: "w-12 h-12 bg-white rounded-full flex items-center justify-center" },
                            React.createElement("span", { className: "text-purple-600 font-bold text-lg" }, "U")
                        ),
                        React.createElement("div", null,
                            React.createElement("h3", { className: "text-white font-semibold" }, "@demoUser"),
                            React.createElement("p", { className: "text-white text-opacity-80 text-sm" }, "Tajib Creator")
                        )
                    ),
                    React.createElement("div", { className: "space-y-4 flex-1" },
                        React.createElement(motion.button, {
                            whileHover: { scale: 1.05, boxShadow: "0 10px 30px rgba(255, 255, 255, 0.4)" },
                            whileTap: { scale: 0.95 },
                            onClick: onUploadClick,
                            className: "w-full ripple bg-white bg-opacity-20 text-white py-3 px-4 rounded-lg font-medium text-left flex items-center space-x-3"
                        },
                            React.createElement("span", null, "ðŸ“¤"),
                            React.createElement("span", null, "Upload Tajib")
                        ),
                        React.createElement(motion.button, {
                            whileHover: { scale: 1.05, boxShadow: "0 10px 30px rgba(255, 255, 255, 0.4)" },
                            whileTap: { scale: 0.95 },
                            onClick: onSearchClick,
                            className: "w-full ripple bg-white bg-opacity-20 text-white py-3 px-4 rounded-lg font-medium text-left flex items-center space-x-3"
                        },
                            React.createElement("span", null, "ðŸ”"),
                            React.createElement("span", null, "Search Tajibs")
                        )
                    ),
                    React.createElement(motion.div, {
                        initial: { y: 20, opacity: 0 },
                        animate: { y: 0, opacity: 1 },
                        transition: { delay: 0.4 },
                        className: "text-center text-white text-opacity-60 text-sm mt-auto pt-4"
                    }, "Tajib Tok Â© 2025")
                )
            );
        }

        // Right Sidebar Component
        function SidebarRight() {
            const actions = [
                { icon: 'â¤ï¸', label: 'Like', count: '1.2K' },
                { icon: 'ðŸ’¬', label: 'Comments', count: '245' },
                { icon: 'ðŸ”—', label: 'Share', count: '89' },
                { icon: 'ðŸ‘¤', label: 'Profile', count: '' }
            ];

            return React.createElement(motion.div, {
                initial: { x: 100, opacity: 0 },
                animate: { x: 0, opacity: 1 },
                transition: { duration: 0.5 },
                className: "w-20 h-full p-6"
            },
                React.createElement("div", { className: "material-glass h-full flex flex-col items-center justify-center space-y-8" },
                    actions.map((action, index) => 
                        React.createElement(motion.div, {
                            key: action.label,
                            initial: { y: 20, opacity: 0 },
                            animate: { y: 0, opacity: 1 },
                            transition: { delay: index * 0.1 + 0.3 },
                            className: "flex flex-col items-center space-y-2"
                        },
                            React.createElement(motion.button, {
                                whileHover: { scale: 1.15, rotate: 5 },
                                whileTap: { scale: 0.9, rotate: -5 },
                                className: "w-14 h-14 bg-white rounded-full flex items-center justify-center text-2xl shadow-lg ripple"
                            }, action.icon),
                            React.createElement("span", { className: "text-white text-sm font-medium" }, action.count),
                            React.createElement("span", { className: "text-white text-opacity-80 text-xs" }, action.label)
                        )
                    )
                )
            );
        }

        // Tajib Player Component
        function TajibPlayer({ video, isActive }) {
            const videoRef = React.useRef();
            const [isPlaying, setIsPlaying] = React.useState(false);
            const [isLoading, setIsLoading] = React.useState(true);

            React.useEffect(() => {
                const videoElement = videoRef.current;
                if (!videoElement) return;

                const handleLoadStart = () => setIsLoading(true);
                const handleLoadedData = () => setIsLoading(false);
                const handlePlay = () => setIsPlaying(true);
                const handlePause = () => setIsPlaying(false);

                videoElement.addEventListener('loadstart', handleLoadStart);
                videoElement.addEventListener('loadeddata', handleLoadedData);
                videoElement.addEventListener('play', handlePlay);
                videoElement.addEventListener('pause', handlePause);

                if (isActive) {
                    videoElement.play().catch(console.error);
                } else {
                    videoElement.pause();
                    videoElement.currentTime = 0;
                }

                return () => {
                    videoElement.removeEventListener('loadstart', handleLoadStart);
                    videoElement.removeEventListener('loadeddata', handleLoadedData);
                    videoElement.removeEventListener('play', handlePlay);
                    videoElement.removeEventListener('pause', handlePause);
                };
            }, [isActive, video.url]);

            return React.createElement(motion.div, {
                layout: true,
                className: "relative rounded-2xl overflow-hidden bg-black w-full max-w-sm video-container shadow-2xl",
                whileHover: { scale: 1.02 },
                transition: { type: "spring", stiffness: 300 }
            },
                React.createElement("video", {
                    ref: videoRef,
                    src: video.url,
                    loop: true,
                    muted: true,
                    playsInline: true,
                    className: "w-full h-full object-cover",
                    onError: (e) => console.error('Video loading error:', e)
                }),
                isLoading && React.createElement("div", { 
                    className: "absolute inset-0 flex items-center justify-center" 
                },
                    React.createElement(motion.div, {
                        animate: { rotate: 360 },
                        transition: { duration: 1, repeat: Infinity, ease: "linear" },
                        className: "w-12 h-12 border-4 border-white border-opacity-30 border-t-white rounded-full"
                    })
                ),
                React.createElement("div", { 
                    className: "absolute bottom-0 left-0 right-0 p-6 bg-gradient-to-t from-black/80 to-transparent" 
                },
                    React.createElement(motion.h3, {
                        initial: { y: 20, opacity: 0 },
                        animate: { y: 0, opacity: 1 },
                        transition: { delay: 0.2 },
                        className: "text-white font-semibold text-lg mb-2"
                    }, video.caption || "Untitled Tajib"),
                    React.createElement(motion.p, {
                        initial: { y: 20, opacity: 0 },
                        animate: { y: 0, opacity: 1 },
                        transition: { delay: 0.3 },
                        className: "text-white text-opacity-80 text-sm"
                    }, `@${video.username || 'tajibCreator'}`)
                ),
                React.createElement(AnimatePresence, null,
                    !isPlaying && isActive && React.createElement(motion.div, {
                        initial: { scale: 0, opacity: 0 },
                        animate: { scale: 1, opacity: 1 },
                        exit: { scale: 0, opacity: 0 },
                        className: "absolute inset-0 flex items-center justify-center"
                    },
                        React.createElement("div", { 
                            className: "w-20 h-20 bg-black bg-opacity-50 rounded-full flex items-center justify-center" 
                        },
                            React.createElement("span", { className: "text-white text-4xl" }, "â–¶ï¸")
                        )
                    )
                )
            );
        }

        // Tajib Feed Component
        function TajibFeed({ videos }) {
            const [currentIndex, setCurrentIndex] = React.useState(0);
            const feedRef = React.useRef();

            const handleScroll = (e) => {
                const { scrollTop, clientHeight } = e.target;
                const newIndex = Math.round(scrollTop / clientHeight);
                
                if (newIndex !== currentIndex && newIndex >= 0 && newIndex < videos.length) {
                    setCurrentIndex(newIndex);
                }
            };

            const handleWheel = (e) => {
                e.preventDefault();
                const direction = e.deltaY > 0 ? 1 : -1;
                const newIndex = Math.max(0, Math.min(videos.length - 1, currentIndex + direction));
                
                if (newIndex !== currentIndex) {
                    setCurrentIndex(newIndex);
                    if (feedRef.current) {
                        feedRef.current.scrollTo({
                            top: newIndex * feedRef.current.clientHeight,
                            behavior: 'smooth'
                        });
                    }
                }
            };

            React.useEffect(() => {
                const feed = feedRef.current;
                if (feed && videos.length > 0) {
                    const scrollToIndex = Math.min(currentIndex, videos.length - 1);
                    feed.scrollTop = scrollToIndex * feed.clientHeight;
                }
            }, [currentIndex, videos.length]);

            if (videos.length === 0) {
                return React.createElement(motion.div, {
                    initial: { opacity: 0, scale: 0.97 },
                    animate: { opacity: 1, scale: 1 },
                    transition: { duration: 0.5 },
                    className: "flex-1 max-w-md h-screen flex items-center justify-center"
                },
                    React.createElement("div", { className: "text-center text-white" },
                        React.createElement("div", { className: "text-6xl mb-4" }, "ðŸŽ¬"),
                        React.createElement("h2", { className: "text-2xl font-bold mb-2" }, "No Tajibs Yet"),
                        React.createElement("p", { className: "text-white text-opacity-80" }, "Upload the first video to get started!")
                    )
                );
            }

            return React.createElement(motion.div, {
                initial: { opacity: 0, scale: 0.97 },
                animate: { opacity: 1, scale: 1 },
                transition: { duration: 0.5 },
                className: "flex-1 max-w-md h-screen overflow-hidden"
            },
                React.createElement("div", {
                    ref: feedRef,
                    onScroll: handleScroll,
                    onWheel: handleWheel,
                    className: "h-full overflow-y-auto snap-y snap-mandatory scrollbar-hide"
                },
                    React.createElement(AnimatePresence, { mode: "wait" },
                        videos.map((video, index) =>
                            React.createElement(motion.div, {
                                key: video.id || index,
                                initial: { opacity: 0, y: 50 },
                                animate: { 
                                    opacity: index === currentIndex ? 1 : 0.3,
                                    y: 0,
                                    scale: index === currentIndex ? 1 : 0.95
                                },
                                exit: { opacity: 0, y: -50 },
                                transition: { duration: 0.3 },
                                className: "h-full snap-start flex items-center justify-center p-4"
                            },
                                React.createElement(TajibPlayer, {
                                    video: video,
                                    isActive: index === currentIndex
                                })
                            )
                        )
                    )
                )
            );
        }

        // Upload Modal Component - REAL UPLOAD FUNCTIONALITY
        function UploadModal({ onClose, onUploadSuccess }) {
            const [file, setFile] = React.useState(null);
            const [caption, setCaption] = React.useState('');
            const [uploadProgress, setUploadProgress] = React.useState(0);
            const [isUploading, setIsUploading] = React.useState(false);
            const [previewUrl, setPreviewUrl] = React.useState('');

            const handleFileSelect = (e) => {
                const selectedFile = e.target.files[0];
                if (selectedFile && selectedFile.type.startsWith('video/')) {
                    setFile(selectedFile);
                    setPreviewUrl(URL.createObjectURL(selectedFile));
                } else {
                    alert('Please select a video file');
                }
            };

            const handleUpload = async () => {
                if (!file) {
                    alert('Please select a video file first');
                    return;
                }

                setIsUploading(true);
                setUploadProgress(0);

                try {
                    // Generate unique file name
                    const fileExt = file.name.split('.').pop();
                    const fileName = `${Math.random().toString(36).substring(2)}_${Date.now()}.${fileExt}`;
                    const filePath = `videos/${fileName}`;

                    console.log('Starting upload...', filePath);

                    // Upload to Supabase Storage
                    const { data: uploadData, error: uploadError } = await supabase.storage
                        .from('videos')
                        .upload(filePath, file, {
                            cacheControl: '3600',
                            upsert: false,
                            onUploadProgress: (progress) => {
                                const percent = (progress.loaded / progress.total) * 100;
                                setUploadProgress(percent);
                                console.log(`Upload progress: ${percent}%`);
                            }
                        });

                    if (uploadError) {
                        console.error('Upload error:', uploadError);
                        throw new Error(`Upload failed: ${uploadError.message}`);
                    }

                    console.log('Upload successful:', uploadData);

                    // Get public URL
                    const { data: urlData } = supabase.storage
                        .from('videos')
                        .getPublicUrl(filePath);

                    console.log('Public URL:', urlData);

                    // Insert record into database
                    const { data: insertData, error: insertError } = await supabase
                        .from('videos')
                        .insert([
                            {
                                filename: file.name,
                                path: filePath,
                                url: urlData.publicUrl,
                                caption: caption || 'Untitled Tajib',
                                username: 'demoUser',
                                created_at: new Date().toISOString()
                            }
                        ])
                        .select();

                    if (insertError) {
                        console.error('Database insert error:', insertError);
                        throw new Error(`Database error: ${insertError.message}`);
                    }

                    console.log('Database insert successful:', insertData);

                    alert('Tajib uploaded successfully!');
                    onUploadSuccess();
                    
                } catch (error) {
                    console.error('Upload process error:', error);
                    alert(`Upload failed: ${error.message}`);
                } finally {
                    setIsUploading(false);
                    setUploadProgress(0);
                }
            };

            return React.createElement(motion.div, {
                initial: { opacity: 0 },
                animate: { opacity: 1 },
                exit: { opacity: 0 },
                className: "fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center p-4 z-50",
                onClick: onClose
            },
                React.createElement(motion.div, {
                    initial: { scale: 0.9, opacity: 0, y: 20 },
                    animate: { scale: 1, opacity: 1, y: 0 },
                    exit: { scale: 0.9, opacity: 0, y: -20 },
                    className: "material-glass w-full max-w-md",
                    onClick: (e) => e.stopPropagation()
                },
                    React.createElement("h2", { className: "text-2xl font-bold text-white mb-6" }, "Upload Tajib"),
                    React.createElement("div", { className: "mb-6" },
                        React.createElement("label", { className: "block text-white mb-2" }, "Choose Video File"),
                        React.createElement("input", {
                            type: "file",
                            accept: "video/*",
                            onChange: handleFileSelect,
                            disabled: isUploading,
                            className: "w-full text-white file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-white file:text-purple-600 hover:file:bg-purple-50 disabled:opacity-50"
                        }),
                        React.createElement("p", { className: "text-white text-opacity-80 text-sm mt-2" }, "Select a video file to upload")
                    ),
                    previewUrl && React.createElement(motion.div, {
                        initial: { opacity: 0, height: 0 },
                        animate: { opacity: 1, height: 'auto' },
                        className: "mb-6"
                    },
                        React.createElement("p", { className: "text-white mb-2" }, "Preview:"),
                        React.createElement("video", {
                            src: previewUrl,
                            controls: true,
                            className: "w-full rounded-lg max-h-60 object-cover"
                        })
                    ),
                    React.createElement("div", { className: "mb-6" },
                        React.createElement("label", { className: "block text-white mb-2" }, "Caption"),
                        React.createElement("input", {
                            type: "text",
                            value: caption,
                            onChange: (e) => setCaption(e.target.value),
                            placeholder: "Add a captivating caption...",
                            disabled: isUploading,
                            className: "w-full px-4 py-3 rounded-lg bg-white bg-opacity-20 text-white placeholder-white placeholder-opacity-60 border border-white border-opacity-30 focus:outline-none focus:border-opacity-60 disabled:opacity-50"
                        })
                    ),
                    isUploading && React.createElement(motion.div, {
                        initial: { opacity: 0 },
                        animate: { opacity: 1 },
                        className: "mb-6"
                    },
                        React.createElement("div", { className: "w-full bg-white bg-opacity-20 rounded-full h-4 mb-2" },
                            React.createElement(motion.div, {
                                initial: { width: 0 },
                                animate: { width: `${uploadProgress}%` },
                                className: "bg-green-500 h-4 rounded-full transition-all duration-300 flex items-center justify-center"
                            },
                                uploadProgress > 10 && React.createElement("span", { 
                                    className: "text-white text-xs font-bold"
                                }, `${Math.round(uploadProgress)}%`)
                            )
                        ),
                        React.createElement("p", { className: "text-white text-center text-sm" }, 
                            `Uploading... ${Math.round(uploadProgress)}%`
                        )
                    ),
                    React.createElement("div", { className: "flex space-x-4" },
                        React.createElement(motion.button, {
                            whileHover: { scale: 1.05 },
                            whileTap: { scale: 0.95 },
                            onClick: onClose,
                            disabled: isUploading,
                            className: "flex-1 py-3 px-6 bg-white bg-opacity-20 text-white rounded-lg font-medium disabled:opacity-50"
                        }, "Cancel"),
                        React.createElement(motion.button, {
                            whileHover: { scale: 1.05 },
                            whileTap: { scale: 0.95 },
                            onClick: handleUpload,
                            disabled: !file || isUploading,
                            className: "flex-1 py-3 px-6 bg-white text-purple-600 rounded-lg font-medium disabled:opacity-50"
                        }, isUploading ? 'Uploading...' : 'Upload Tajib')
                    )
                )
            );
        }

        // Search Panel Component
        function SearchPanel({ onClose, onSearch, searchResults }) {
            const [query, setQuery] = React.useState('');

            const handleSearchChange = (e) => {
                const value = e.target.value;
                setQuery(value);
                onSearch(value);
            };

            const handleVideoSelect = (video) => {
                // This would navigate to the video in a real app
                alert(`Selected: ${video.caption}`);
            };

            return React.createElement(motion.div, {
                initial: { opacity: 0 },
                animate: { opacity: 1 },
                exit: { opacity: 0 },
                className: "fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-start justify-center p-4 z-50 pt-20",
                onClick: onClose
            },
                React.createElement(motion.div, {
                    initial: { scale: 0.9, opacity: 0, y: -50 },
                    animate: { scale: 1, opacity: 1, y: 0 },
                    exit: { scale: 0.9, opacity: 0, y: -50 },
                    className: "material-glass w-full max-w-2xl max-h-[80vh] overflow-hidden",
                    onClick: (e) => e.stopPropagation()
                },
                    React.createElement("div", { className: "flex items-center space-x-4 mb-6" },
                        React.createElement(motion.button, {
                            whileHover: { scale: 1.1 },
                            whileTap: { scale: 0.9 },
                            onClick: onClose,
                            className: "w-10 h-10 flex items-center justify-center text-white text-xl"
                        }, "âœ•"),
                        React.createElement("div", { className: "flex-1" },
                            React.createElement("input", {
                                type: "text",
                                value: query,
                                onChange: handleSearchChange,
                                placeholder: "Search for amazing tajibs...",
                                className: "w-full px-4 py-3 rounded-lg bg-white bg-opacity-20 text-white placeholder-white placeholder-opacity-60 border border-white border-opacity-30 focus:outline-none focus:border-opacity-60",
                                autoFocus: true
                            })
                        )
                    ),
                    React.createElement("div", { className: "overflow-y-auto max-h-[60vh]" },
                        React.createElement(AnimatePresence, { mode: "wait" },
                            query.trim() ? 
                                React.createElement(motion.div, {
                                    key: "results",
                                    initial: { opacity: 0 },
                                    animate: { opacity: 1 },
                                    exit: { opacity: 0 },
                                    className: "space-y-4"
                                },
                                    searchResults.length > 0 ? 
                                        searchResults.map((video, index) =>
                                            React.createElement(motion.div, {
                                                key: video.id,
                                                initial: { opacity: 0, y: 20 },
                                                animate: { opacity: 1, y: 0 },
                                                transition: { delay: index * 0.1 },
                                                className: "flex items-center space-x-4 p-4 rounded-lg bg-white bg-opacity-10 hover:bg-opacity-20 cursor-pointer transition-all duration-200",
                                                onClick: () => handleVideoSelect(video)
                                            },
                                                React.createElement("div", { 
                                                    className: "w-20 h-20 bg-black rounded-lg overflow-hidden flex-shrink-0 flex items-center justify-center"
                                                },
                                                    React.createElement("video", {
                                                        src: video.url,
                                                        className: "w-full h-full object-cover"
                                                    })
                                                ),
                                                React.createElement("div", { className: "flex-1 min-w-0" },
                                                    React.createElement("h4", { className: "text-white font-semibold truncate" }, 
                                                        video.caption || "Untitled Tajib"
                                                    ),
                                                    React.createElement("p", { className: "text-white text-opacity-80 text-sm truncate" }, 
                                                        `@${video.username || 'tajibCreator'}`
                                                    ),
                                                    React.createElement("p", { className: "text-white text-opacity-60 text-xs" }, 
                                                        {new Date(video.created_at).toLocaleDateString()}
                                                    )
                                                )
                                            )
                                        )
                                    : 
                                        React.createElement(motion.div, {
                                            initial: { opacity: 0 },
                                            animate: { opacity: 1 },
                                            className: "text-center py-12"
                                        },
                                            React.createElement("p", { className: "text-white text-opacity-80" }, 
                                                `No tajibs found for "${query}"`
                                            )
                                        )
                                )
                            : 
                                React.createElement(motion.div, {
                                    key: "placeholder",
                                    initial: { opacity: 0 },
                                    animate: { opacity: 1 },
                                    exit: { opacity: 0 },
                                    className: "text-center py-12"
                                },
                                    React.createElement("p", { className: "text-white text-opacity-80" }, 
                                        "Search for amazing tajibs by caption..."
                                    )
                                )
                        )
                    )
                )
            );
        }

        // Main App Component
        function App() {
            const [videos, setVideos] = React.useState([]);
            const [showUploadModal, setShowUploadModal] = React.useState(false);
            const [showSearchPanel, setShowSearchPanel] = React.useState(false);
            const [searchResults, setSearchResults] = React.useState([]);
            const [loading, setLoading] = React.useState(true);

            // Load videos from Supabase
            const fetchVideos = async () => {
                try {
                    setLoading(true);
                    console.log('Fetching videos from Supabase...');
                    
                    const { data, error } = await supabase
                        .from('videos')
                        .select('*')
                        .order('created_at', { ascending: false });
                    
                    if (error) {
                        console.error('Error fetching videos:', error);
                        throw error;
                    }
                    
                    console.log('Fetched videos:', data);
                    setVideos(data || []);
                    
                } catch (error) {
                    console.error('Failed to fetch videos:', error);
                    alert('Error loading videos. Check console for details.');
                    // Set some demo videos if fetch fails
                    setVideos([
                        {
                            id: 1,
                            caption: "Welcome to Tajib Tok!",
                            username: "system",
                            url: "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerJoyrides.mp4",
                            created_at: new Date().toISOString()
                        }
                    ]);
                } finally {
                    setLoading(false);
                }
            };

            React.useEffect(() => {
                fetchVideos();
            }, []);

            const handleSearch = async (query) => {
                if (!query.trim()) {
                    setSearchResults([]);
                    return;
                }

                try {
                    const { data, error } = await supabase
                        .from('videos')
                        .select('*')
                        .ilike('caption', `%${query}%`)
                        .order('created_at', { ascending: false });

                    if (!error) {
                        setSearchResults(data || []);
                    }
                } catch (error) {
                    console.error('Search error:', error);
                    setSearchResults([]);
                }
            };

            if (loading) {
                return React.createElement("div", { 
                    className: "min-h-screen bg-gradient-to-br from-purple-600 to-blue-600 flex items-center justify-center" 
                },
                    React.createElement(motion.div, {
                        animate: { rotate: 360 },
                        transition: { duration: 1, repeat: Infinity, ease: "linear" },
                        className: "w-16 h-16 border-4 border-white border-opacity-30 border-t-white rounded-full"
                    })
                );
            }

            return React.createElement("div", { className: "min-h-screen bg-gradient-to-br from-purple-600 to-blue-600" },
                React.createElement("div", { className: "flex h-screen max-w-7xl mx-auto" },
                    React.createElement(SidebarLeft, {
                        onUploadClick: () => setShowUploadModal(true),
                        onSearchClick: () => setShowSearchPanel(true)
                    }),
                    React.createElement("div", { className: "flex-1 flex justify-center" },
                        React.createElement(TajibFeed, { videos: videos })
                    ),
                    React.createElement(SidebarRight, null)
                ),
                React.createElement(AnimatePresence, null,
                    showUploadModal && React.createElement(UploadModal, {
                        onClose: () => setShowUploadModal(false),
                        onUploadSuccess: () => {
                            setShowUploadModal(false);
                            fetchVideos(); // Refresh the feed
                        }
                    })
                ),
                React.createElement(AnimatePresence, null,
                    showSearchPanel && React.createElement(SearchPanel, {
                        onClose: () => setShowSearchPanel(false),
                        onSearch: handleSearch,
                        searchResults: searchResults
                    })
                )
            );
        }

        // Render the App
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>
